---
title: "Untitled"
output: html_document
date: "2024-02-05"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readxl)
library(lubridate)
library(tidyverse)
library(ggplot2)
```


```{r}
data_ex = list()
for (i in 1:4){
data_ex[[i]] = read_xlsx('даные гидромет.xlsx', sheet = i)
} 

t = seq(ymd('1938-01-01'),ymd('1940-12-31'), by = 'days') %>% data.frame() 
colnames(t) = 'ДАТА'

t1 = t %>% left_join(data_ex[[1]]) %>% na.omit()
t2 = t %>% left_join(data_ex[[2]]) %>% na.omit()
t3 = t %>% left_join(data_ex[[3]]) %>% na.omit()
t4 = t %>% left_join(data_ex[[4]]) %>% na.omit()

susp = t2 %>% bind_rows(t4) %>% select(-c(`№`, `дата`, `ГОД`, `tip`)) %>% right_join(t)
colnames(susp) = c('ДАТА', 'уровень susp', 'Расход взвешенных, кг/с', 'Расход воды, м3/с susp', 'мутность, мг/л')
bed = t1 %>% bind_rows(t3) %>% select(-c(`№`, `Дата`, `ГОД`, `tip`)) %>% right_join(t)
colnames(bed) = c('ДАТА', 'уровень bed', 'расход влекомых, кг/с', 'Расход воды, м3/с bed')

susp_bed = susp %>% full_join(bed) %>% na.omit() %>% mutate(
  tota_load = `расход влекомых, кг/с` + `Расход взвешенных, кг/с`, 
  precentage = round(`расход влекомых, кг/с` / tota_load *100, 1)) %>% select(-c(`Расход воды, м3/с bed`, `уровень bed`))


susp_bed = susp_bed %>% mutate(`Расход взвешенных, кг/с` = round(`Расход взвешенных, кг/с`, 1)
                               ,`мутность, мг/л` =  round(`мутность, мг/л`, 0)
                               ,`расход влекомых, кг/с`  = round(`расход влекомых, кг/с`, 1)
                               ,tota_load = round(tota_load, 0)
                               ) %>% select(-`уровень susp`)

colnames(susp_bed) = c('Дата', "Расход взвешенных наносов, кг/с", "Расход воды, м3/с", "Мутность, мг/л", "Расход влекомых наносов, кг/с", 'Суммарный сток наносов, кг/с', 'Доля влекомого стока, %')

psych::corPlot(select(susp_bed, -`Дата`), xlas = 2 )



```


