"0","# meteo = read.csv('Jankuat_meteo_2023.txt', header = T, sep = '', skip = 1) %>% mutate(d =  dmy_hm(paste0(Date, ' ', Time)), "
"0","# 	                                                                                      temp = Out, "
"0","# 	                                                                                      rain = Rain) %>% select(d, temp, rain) %>% subset(year(d) == 2023)"
"0",""
"0","meteo = read_xlsx('sources/Davis_meteo_23.xlsx') %>% transmute(d = `Data Time`, temp = `Temp Out`, rain =  as.numeric(`Rain`))"
"2","New names:"
"0","seq_15min = seq.POSIXt(ymd_hms('2023-05-01 00:00:00'),ymd_hms('2023-10-01 00:00:00'), by = '15 min') %>% data.frame() "
"0","colnames(seq_15min) = 'd'"
"0",""
"0","seq_15min = seq_15min %>% mutate(x = ' ') %>% left_join(meteo) %>% "
"0","  select(-x) %>% apply(., c(1, 2), FUN = function(x) ifelse(is.na(x) == T, -999, x))"
"2","Joining with `by = join_by(d)`"
"0","meteo = data.frame(seq_15min)"
"0","meteo$d = ymd_hms(meteo$d)"
"0","meteo$temp = as.numeric(meteo$temp)"
"0","meteo$rain = as.numeric(meteo$rain)"
"0",""
"0","kinzhka = readxl::read_xlsx('sources/Джан_водомерные_наблюдения_2023.xlsx', sheet = 1) %>% mutate(d = ymd_hms(paste0(ymd(`Дата`), ' ', paste(hour(ymd_hms(`Время`)),minute(ymd_hms(`Время`)),second(ymd_hms(`Время`)), sep="":"")))) %>% select(d, SSC, temp_water)"
"0",""
"0","discharge = readxl::read_xlsx('sources/книжка август .xlsx', sheet = 5) %>% mutate(d = ymd_hms(`Дата`), level = `H_privod скользящее среднее`) %>% select(d,Q, level) "
"2","New names:"
"0","data_ch = meteo %>% left_join(kinzhka) %>% na.omit()"
"2","Joining with `by = join_by(d)`"
"0","data = meteo %>% left_join(kinzhka)"
"2","Joining with `by = join_by(d)`"
"0","data[1, ] = data_ch[1, ]"
"0","data[nrow(data), ] = data_ch[nrow(data_ch), ]"
"0",""
"0",""
"0","data = data  %>% left_join(discharge) %>%  mutate(SSC = zoo::na.approx(SSC), temp_water = zoo::na.approx(temp_water), Q = zoo::na.approx(Q, rule = 2, maxgap = 20), level = zoo::na.approx(level, rule = 2, maxgap = 20))"
"2","Joining with `by = join_by(d)`"
"0","data_agg_rain = data %>% mutate(date1 = date(d), h = day(d)) %>% group_by(date1, h) %>% select(-d) %>% summarise_all(sum) %>% select(date1, h, rain)"
"0",""
"0","data_agg1 = data %>% mutate(date1 = date(d), h = day(d)) %>% group_by(date1, h) %>% summarise_all(mean) %>% select(-rain, d) %>% left_join(data_agg_rain) "
"2","Joining with `by = join_by(date1, h)`"
"0","data_2023 = data_agg1 %>% apply(., c(1, 2), FUN = function(x) ifelse(as.numeric(x) > -10, x, NA)) %>% data.frame() %>% "
"0","  mutate("
"0","date = date(data_agg1$d)"
"0",",ssc = as.numeric(SSC)"
"0",",q = as.numeric(Q)"
"0",",rain_mm = as.numeric(rain)"
"0",",t2_c = as.numeric(temp)"
"0",""
"0",") %>% select(date, t2_c,ssc, rain_mm, q, ssc)"
"0","  "
"0","rm(data_agg1, data_agg_rain, discharge, kinzhka, seq_15min, meteo, data_ch)"
